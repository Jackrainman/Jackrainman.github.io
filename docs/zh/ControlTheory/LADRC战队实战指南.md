# LADRC调参指南

> **目标读者**：已有PID基础的大二战队成员
> **配套代码**：[03-LADRC代码实战.md](./03-LADRC代码实战.md)

---

## 一、LADRC是什么

### 1.1 核心公式

LADRC（线性自抗扰控制）就记住这一个公式：

$$
u = (u₀ - ẑ₃) / b₀
$$

- `u₀`：PID算出来的控制量
- `ẑ₃`：观测器估计的总扰动
- `b₀`：系统控制效率系数

**人话**：PID只管追踪目标，LADRC额外做一件事——**实时估计干扰并把它干掉**。

### 1.2 核心思想（扰动估计+补偿）

LADRC的精髓就一句话：**把所有不确定性打包成"总扰动"，实时估计并补偿**。

```
PID的思路：看到偏差 → 调整输出
LADRC的思路：看到偏差 → 判断是目标变了还是扰动了 → 分别处理
```

- **内环（LESO）**：快速估计"总扰动"（包括外部干扰+模型误差）
- **外环（LSEF）**：像PID一样追踪目标

补偿后，复杂系统变成简单的**积分器串联型**，控制变得超简单。

---

## 二、LADRC vs PID

### 2.1 原理对比

| 对比项 | PID | LADRC |
|:------:|:---:|:-----:|
| **核心机制** | 看到误差再调整 | 主动估计并抵消扰动 |
| **模型依赖** | 不需要 | 几乎不需要（只需阶数） |
| **抗干扰** | 靠积分器慢慢压 | 观测器实时估计补偿 |
| **响应速度** | 快，但超调大 | 快，且超调小 |

### 2.2 结构对比

```
PID结构：
目标 ──→[PID]──→ 被控对象 ──→ 输出
         ▲                │
         └──── 反馈 ──────┘

LADRC结构：
目标 ──→[TD]──→[LSEF]──┬──→ 被控对象 ──→ 输出
                       │          │
              [扰动补偿]│          │
                       │          ▼
                    [LESO]←──────┘
```

- **TD**：把跳变目标平滑化（防冲击）
- **LSEF**：类似PID，计算虚拟控制量
- **LESO**：观测器，估计状态和总扰动
- **扰动补偿**：把估计的扰动抵消掉

### 2.3 参数对比（⭐重点）

| 控制器 | 参数 | 物理意义 |
|:------:|:----:|:---------|
| **PID** | Kp, Ki, Kd | 比例/积分/微分增益 |
| **LADRC** | ωc, ωo, b₀ | 控制器带宽/观测器带宽/控制效率 |

**关键区别**：
- PID的3个参数耦合严重，调一个影响全局
- LADRC的3个参数物理意义清晰，**按顺序调即可**

---

## 三、LADRC的优势

### 3.1 抗扰能力强

PID抗干扰主要靠**积分器**，但积分器有滞后，突变扰动时反应慢。

LADRC通过**LESO实时估计扰动**，在扰动影响输出前就补偿掉。

**实测对比**：同样突加负载，PID需要3-5个周期恢复，LADRC只需1-2个周期。

### 3.2 不依赖模型

PID不依赖模型，但性能受限；传统模型控制（如MPC）需要精确模型。

LADRC只需要知道**系统阶数**（输入到输出经过几次积分）：
- 电机位置控制 → 二阶（电压→速度→位置）
- 温度控制 → 一阶（功率→温度）
- 电流控制 → 一阶（电压→电流）

其他参数（惯性、摩擦等）通通打包成"总扰动"，LESO自动估计。

### 3.3 参数整定简单

LADRC把复杂参数整定变成**带宽设计**：

```
ωc = 控制器带宽（决定响应快慢）
ωo = 观测器带宽（决定估计快慢）
b₀ = 控制效率（从阶跃响应估算）
```

经验公式：**ωo = (3~5) × ωc**，调好ωc再按比例调ωo即可。

---

## 四、参数详解（TD + LADRC）

### 4.1 TD参数

跟踪微分器（TD）用于**平滑目标信号**和**提取微分**。

| 参数 | 名称 | 作用 | 怎么调 |
|:----:|:----:|:-----|:-------|
| **r** | 速度因子 | 决定跟踪速度 | 目标跳变超调大 → 减小r；响应慢 → 增大r |
| **h₀** | 滤波因子 | 决定平滑程度 | 噪声大 → 增大h₀；相位滞后大 → 减小h₀ |
| **h** | 积分步长 | 采样周期 | 就是控制周期，一般不动 |

**口诀**：
- `r`越大，跟踪越快，但可能超调
- `h₀`越大，滤波越强，但滞后越大

### 4.2 LADRC参数

#### b₀（扰动补偿系数）

**物理意义**：控制效率，单位控制量能产生多大加速度。

**怎么估**：
```
给被控对象一个阶跃输入U，测初始加速度a
b₀ = a / U
```

**调参**：
- 系统振荡 → b₀设大了，减小10%
- 响应迟缓 → b₀设小了，增大10%
- 不需要很准，±30%误差都能接受

#### ωc（控制器带宽）

**物理意义**：闭环系统响应速度，类似PID的Kp但物理意义更清晰。

**初始值**：
```
期望调节时间T（如0.1s）→ ωc ≈ 10 / T = 100
```

**调参**：
- 响应慢 → 增大ωc（每次+20%）
- 超调/振荡 → 减小ωc（每次-20%）

#### ωo（观测器带宽）

**物理意义**：LESO估计扰动的速度，必须**快于**控制器才能及时补偿。

**经验公式**：
```
ωo = (3 ~ 5) × ωc
```

| 场景 | 推荐比例 | 说明 |
|:----:|:--------:|:-----|
| 噪声大 | 3× | 滤波效果好，估计略慢 |
| 通用 | 4× | 平衡性能，推荐 |
| 快速响应 | 5× | 估计快，但对噪声敏感 |

**调参**：
- 估计滞后明显（扰动后很久才补偿）→ 增大ωo
- 噪声敏感（输出抖动）→ 减小ωo

### 4.3 参数调节建议

**调节顺序**：
```
步骤1: 估计b₀（阶跃法）
步骤2: 设ωc为期望带宽的50%（保守起步）
步骤3: 设ωo = 4×ωc
步骤4: 测试响应，调ωc到满意
步骤5: 调ωo优化抗扰性能
步骤6: 微调b₀消除振荡或迟缓
```

---

### 五、参数调节原则

**四句话**：
```
响应慢 → 增ωc
有振荡 → 减ωc或减b₀
估计慢 → 增ωo
噪声大 → 减ωo
```

**调试技巧**：
1. 先调ωc让响应速度满意
2. 再调ωo优化抗扰性能
3. 最后微调b₀消除初始状态的振荡
4. TD参数（r、h₀）用来优化目标跟踪的平滑性

**避坑提醒**：
- ωo不要超过10×ωc（会噪声爆炸）
- b₀不准没关系，LESO在跑起来之后会补偿

---

## 代码参考

完整代码实现、调试技巧、常见问题排查，详见：

**→ [03-LADRC代码实战.md](./03-LADRC代码实战.md)**

---

> 💡 **最后提醒**：LADRC不是万能的，但它把工程中最头疼的"不确定性"和"干扰"问题用统一框架解决了。先跑通代码，再理解原理，最后根据实际系统调参，你会发现它比PID更"省心"。
